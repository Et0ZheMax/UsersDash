# UsersDash

Веб-приложение на Flask для администраторов и клиентов фермерских аккаунтов. Проект включает
интерфейс администратора и личный кабинет клиента, интегрируется с внешними серверами через REST API,
умет создавать ежедневные бэкапы и выполняет базовые health-check'и при запуске.

## Описание

- Поддержка многопользовательских ролей: администратор и клиент с разными маршрутами входа.
- Управление фермами и серверами, сбор статуса ресурсов и показ актуальных тарифов.
- Простые миграции для SQLite через вспомогательные скрипты `migrate_*.py`.
- Автоматическое создание дефолтного администратора и ежедневных бэкапов БД.

## Структура проекта

- `UsersDash/app.py` — фабрика приложения и точка входа (`python -m UsersDash.app`).
- `UsersDash/models.py` — модели SQLAlchemy: пользователи, серверы, аккаунты, логи и данные фермы.
- `UsersDash/services/` — вспомогательные сервисы (бэкапы, проверки здоровья, аудиторский лог и др.).
- `UsersDash/templates/` и `UsersDash/static/` — Jinja2-шаблоны и статические файлы интерфейса.
- `UsersDash/tests/` — автотесты на `unittest` для аудита настроек и проверок логов.
- Скрипты `migrate_*.py` и `reset_admin_password.py` — локальные миграции и сброс пароля администратора.

## Быстрый старт

1. Установите Python 3.10+ и создайте виртуальное окружение: `python -m venv .venv && source .venv/bin/activate`.
2. Установите зависимости: `pip install -r requirements.txt`.
3. Установите секретный ключ (необязательно для локального запуска):
   `export MULTIDASH_SECRET_KEY='your-secret-key'`.
4. Запустите приложение:
   - для разработки: `python -m UsersDash.app`;
   - через Flask CLI: `flask --app UsersDash.app run --debug`.
5. При первом старте создаётся база `UsersDash/data/app.db` и пользователь admin/admin
   (смените пароль в админке или через `reset_admin_password.py`).

## Тестирование

- Запустите быстрые проверки кода: `python -m unittest discover UsersDash/tests`.
- Скрипт `run_integrity_checks.py` выполняет статические проверки шаблонов и сборку модулей.

## Работа с данными и миграциями

- Все данные по умолчанию находятся в каталоге `UsersDash/data`; при переносе окружения скопируйте его
  вместе с бэкапами из `UsersDash/data/backups`.
- Миграционные скрипты `migrate_*.py` запускаются вручную: `python UsersDash/migrate_add_account_columns.py` и т.д.
- Для резервных копий используется сервис `UsersDash/services/db_backup.py`, бэкапы создаются ежедневно
  фоновым потоком.

## Полезные ссылки по коду

- Аутентификация и вход: `UsersDash/auth.py` и блюпринт `auth_bp`.
- Админские маршруты: `UsersDash/admin_views.py` (управление аккаунтами, тарифами, экспорт логов).
- Клиентские маршруты: `UsersDash/client_views.py` (дашборд, формы с данными фермы).
- API для внешних сервисов: `UsersDash/api_views.py` и клиент `UsersDash/services/remote_api.py`.
