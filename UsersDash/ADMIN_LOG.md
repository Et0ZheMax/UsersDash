# Лог настроек

Новый раздел админки **«Лог настроек»** показывает действия по настройкам аккаунтов и шагов.

## Что логируется
- Открытие страницы настроек фермы.
- Переключение шагов (IsActive).
- Изменение конфигурации или расписания шага.

Лог хранит пользователя, актора (админ/клиент), идентификатор аккаунта, тип действия, поле, старое/новое значение, IP/UA и метку времени.

## Интерфейс
- Фильтры: пользователь, актор, дата «с/по», тип действия, поиск по полю и значению.
- Экспорт: кнопки CSV/JSON над таблицей.
- Кнопка «Показать дифф» раскрывает unified diff по старому/новому значениям для текстовых полей.
- Пагинация и сортировка по дате.

## Ограничения доступа
Раздел доступен только администраторам; ссылки скрыты из клиентского меню.

## Мониторинг
Пороговые метрики настраиваются переменными конфигурации приложения:
- `AUDIT_ALERT_THRESHOLD` — сколько событий за окно считается всплеском (по умолчанию 20).
- `AUDIT_ALERT_WINDOW_MINUTES` — размер окна в минутах (по умолчанию 10).
- `AUDIT_CRITICAL_FIELDS` — список чувствительных полей для фокусировки алертов.

## Очистка / индекс
Для ускорения поиска добавлен индекс по `(user_id, created_at)`. Для TTL/архивирования можно завести cron/management-команду, удаляющую устаревшие записи (вынести в отдельный скрипт при необходимости).
